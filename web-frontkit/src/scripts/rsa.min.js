var rsa={};var enc={};enc=rsa.fn=rsa.prototype={params:{},init:function(c,b){var a=rsa.fn;rsa.fn._setMaxDigits(130);rsa.fn._initBig();a.params.key=new rsa.fn._pair(c,"",b)},encode:function(p){p=encodeURIComponent(p);var o=this;var h=new Array();var b=p.length;var f=0;while(f<b){h[f]=p.charCodeAt(f);f++}while(h.length%o.params.key.chunkSize!=0){h[f++]=0}var g=h.length;var q="";var e,d,c;for(f=0;f<g;f+=o.params.key.chunkSize){c=new rsa.fn._BigInt();e=0;for(d=f;d<f+o.params.key.chunkSize;++e){c.digits[e]=h[d++];c.digits[e]+=h[d++]<<8}var m=o.params.key.barrett.powMod(c,o.params.key.e);var l=o.params.key.radix==16?rsa.fn._biToHex(m):rsa.fn._biToString(m,o.params.key.radix);q+=l+" "}return q.substring(0,q.length-1)},_initBig:function(){rsa.fn.params.biRadixBase=2;rsa.fn.params.biRadixBits=16;rsa.fn.params.bitsPerDigit=rsa.fn.params.biRadixBits;rsa.fn.params.biRadix=1<<16;rsa.fn.params.biHalfRadix=rsa.fn.params.biRadix>>>1;rsa.fn.params.biRadixSquared=rsa.fn.params.biRadix*rsa.fn.params.biRadix;rsa.fn.params.maxDigitVal=rsa.fn.params.biRadix-1;rsa.fn.params.maxInteger=9999999999999998;rsa.fn.params.maxDigits;rsa.fn.params.ZERO_ARRAY;rsa.fn.params.bigZero;rsa.fn.params.bigOne;rsa.fn.params.dpl10=15;rsa.fn.params.lr10=rsa.fn._biFromNumber(1000000000000000);rsa.fn.params.hexatrigesimalToChar=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z");rsa.fn.params.hexToChar=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");rsa.fn.params.highBitMasks=new Array(0,32768,49152,57344,61440,63488,64512,65024,65280,65408,65472,65504,65520,65528,65532,65534,65535);rsa.fn.params.lowBitMasks=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535)},_setMaxDigits:function(b){rsa.fn.params.maxDigits=b;rsa.fn.params.ZERO_ARRAY=new Array(rsa.fn.params.maxDigits);for(var a=0;a<rsa.fn.params.ZERO_ARRAY.length;a++){rsa.fn.params.ZERO_ARRAY[a]=0}rsa.fn.params.bigZero=new rsa.fn._BigInt();rsa.fn.params.bigOne=new rsa.fn._BigInt();rsa.fn.params.bigOne.digits[0]=1},_BigInt:function(a){if(typeof a=="boolean"&&a==true){this.digits=null}else{this.digits=rsa.fn.params.ZERO_ARRAY.slice(0)}this.isNeg=false},_biFromDecimal:function(e){var d=e.charAt(0)=="-";var c=d?1:0;var a;while(c<e.length&&e.charAt(c)=="0"){++c}if(c==e.length){a=new rsa.fn._BigInt()}else{var b=e.length-c;var f=b%rsa.fn.params.dpl10;if(f==0){f=rsa.fn.params.dpl10}a=rsa.fn._biFromNumber(Number(e.substr(c,f)));c+=f;while(c<e.length){a=rsa.fn._biAdd(rsa.fn.params._biMultiply(a,rsa.fn.params.lr10),rsa.fn._biFromNumber(Number(e.substr(c,rsa.fn.params.dpl10))));c+=rsa.fn.params.dpl10}a.isNeg=d}return a},_biCopy:function(b){var a=new rsa.fn._BigInt(true);a.digits=b.digits.slice(0);a.isNeg=b.isNeg;return a},_biFromNumber:function(c){var a=new rsa.fn._BigInt();a.isNeg=c<0;c=Math.abs(c);var b=0;while(c>0){a.digits[b++]=c&rsa.fn.params.maxDigitVal;c=Math.floor(c/rsa.fn.params.biRadix)}return a},_reverseStr:function(c){var a="";for(var b=c.length-1;b>-1;--b){a+=c.charAt(b)}return a},_biToString:function(d,f){var c=new rsa.fn._BigInt();c.digits[0]=f;var e=rsa.fn._biDivideModulo(d,c);var a=rsa.fn.params.hexatrigesimalToChar[e[1].digits[0]];while(rsa.fn._biCompare(e[0],rsa.fn.params.bigZero)==1){e=rsa.fn._biDivideModulo(e[0],c);digit=e[1].digits[0];a+=rsa.fn.params.hexatrigesimalToChar[e[1].digits[0]]}return(d.isNeg?"-":"")+rsa.fn._reverseStr(a)},_biToDecimal:function(d){var c=new rsa.fn._BigInt();c.digits[0]=10;var e=rsa.fn._biDivideModulo(d,c);var a=String(e[1].digits[0]);while(rsa.fn._biCompare(e[0],rsa.fn.params.bigZero)==1){e=rsa.fn._biDivideModulo(e[0],c);a+=String(e[1].digits[0])}return(d.isNeg?"-":"")+rsa.fn._reverseStr(a)},_digitToHex:function(c){var b=15;var a="";for(i=0;i<4;++i){a+=rsa.fn.params.hexToChar[c&b];c>>>=4}return rsa.fn._reverseStr(a)},_biToHex:function(b){var a="";var d=rsa.fn._biHighIndex(b);for(var c=rsa.fn._biHighIndex(b);c>-1;--c){a+=rsa.fn._digitToHex(b.digits[c])}return a},_charToHex:function(k){var d=48;var b=d+9;var e=97;var h=e+25;var g=65;var f=65+25;var a;if(k>=d&&k<=b){a=k-d}else{if(k>=g&&k<=f){a=10+k-g}else{if(k>=e&&k<=h){a=10+k-e}else{a=0}}}return a},_hexToDigit:function(d){var b=0;var a=Math.min(d.length,4);for(var c=0;c<a;++c){b<<=4;b|=rsa.fn._charToHex(d.charCodeAt(c))}return b},_biFromHex:function(e){var b=new rsa.fn._BigInt();var a=e.length;for(var d=a,c=0;d>0;d-=4,++c){b.digits[c]=rsa.fn._hexToDigit(e.substr(Math.max(d-4,0),Math.min(d,4)))}return b},_biFromString:function(l,k){var a=l.charAt(0)=="-";var e=a?1:0;var m=new rsa.fn._BigInt();var b=new rsa.fn._BigInt();b.digits[0]=1;for(var d=l.length-1;d>=e;d--){var f=l.charCodeAt(d);var g=rsa.fn._charToHex(f);var h=rsa.fn._biMultiplyDigit(b,g);m=rsa.fn._biAdd(m,h);b=rsa.fn._biMultiplyDigit(b,k)}m.isNeg=a;return m},_biDump:function(a){return(a.isNeg?"-":"")+a.digits.join(" ")},_biAdd:function(b,g){var a;if(b.isNeg!=g.isNeg){g.isNeg=!g.isNeg;a=rsa.fn._biSubtract(b,g);
g.isNeg=!g.isNeg}else{a=new rsa.fn._BigInt();var f=0;var e;for(var d=0;d<b.digits.length;++d){e=b.digits[d]+g.digits[d]+f;a.digits[d]=e%rsa.fn.params.biRadix;f=Number(e>=rsa.fn.params.biRadix)}a.isNeg=b.isNeg}return a},_biSubtract:function(b,g){var a;if(b.isNeg!=g.isNeg){g.isNeg=!g.isNeg;a=rsa.fn._biAdd(b,g);g.isNeg=!g.isNeg}else{a=new rsa.fn._BigInt();var f,e;e=0;for(var d=0;d<b.digits.length;++d){f=b.digits[d]-g.digits[d]+e;a.digits[d]=f%rsa.fn.params.biRadix;if(a.digits[d]<0){a.digits[d]+=rsa.fn.params.biRadix}e=0-Number(f<0)}if(e==-1){e=0;for(var d=0;d<b.digits.length;++d){f=0-a.digits[d]+e;a.digits[d]=f%rsa.fn.params.biRadix;if(a.digits[d]<0){a.digits[d]+=rsa.fn.params.biRadix}e=0-Number(f<0)}a.isNeg=!b.isNeg}else{a.isNeg=b.isNeg}}return a},_biHighIndex:function(b){var a=b.digits.length-1;while(a>0&&b.digits[a]==0){--a}return a},_biNumBits:function(c){var f=rsa.fn._biHighIndex(c);var e=c.digits[f];var b=(f+1)*rsa.fn.params.bitsPerDigit;var a;for(a=b;a>b-rsa.fn.params.bitsPerDigit;--a){if((e&32768)!=0){break}e<<=1}return a},_biMultiply:function(h,g){var o=new rsa.fn._BigInt();var f;var b=rsa.fn._biHighIndex(h);var m=rsa.fn._biHighIndex(g);var l,a,d;for(var e=0;e<=m;++e){f=0;d=e;for(j=0;j<=b;++j,++d){a=o.digits[d]+h.digits[j]*g.digits[e]+f;o.digits[d]=a&rsa.fn.params.maxDigitVal;f=a>>>rsa.fn.params.biRadixBits}o.digits[e+b+1]=f}o.isNeg=h.isNeg!=g.isNeg;return o},_biMultiplyDigit:function(a,g){var f,e,d;result=new rsa.fn._BigInt();f=rsa.fn._biHighIndex(a);e=0;for(var b=0;b<=f;++b){d=result.digits[b]+a.digits[b]*g+e;result.digits[b]=d&rsa.fn.params.maxDigitVal;e=d>>>rsa.fn.params.biRadixBits}result.digits[1+f]=e;return result},_arrayCopy:function(e,h,c,g,f){var a=Math.min(h+f,e.length);for(var d=h,b=g;d<a;++d,++b){c[b]=e[d]}},_biShiftLeft:function(b,h){var d=Math.floor(h/rsa.fn.params.bitsPerDigit);var a=new rsa.fn._BigInt();rsa.fn._arrayCopy(b.digits,0,a.digits,d,a.digits.length-d);var g=h%rsa.fn.params.bitsPerDigit;var c=rsa.fn.params.bitsPerDigit-g;for(var e=a.digits.length-1,f=e-1;e>0;--e,--f){a.digits[e]=((a.digits[e]<<g)&rsa.fn.params.maxDigitVal)|((a.digits[f]&rsa.fn.params.highBitMasks[g])>>>(c))}a.digits[0]=((a.digits[e]<<g)&rsa.fn.params.maxDigitVal);a.isNeg=b.isNeg;return a},_biShiftRight:function(b,h){var c=Math.floor(h/rsa.fn.params.bitsPerDigit);var a=new rsa.fn._BigInt();rsa.fn._arrayCopy(b.digits,c,a.digits,0,b.digits.length-c);var f=h%rsa.fn.params.bitsPerDigit;var g=rsa.fn.params.bitsPerDigit-f;for(var d=0,e=d+1;d<a.digits.length-1;++d,++e){a.digits[d]=(a.digits[d]>>>f)|((a.digits[e]&rsa.fn.params.lowBitMasks[f])<<g)}a.digits[a.digits.length-1]>>>=f;a.isNeg=b.isNeg;return a},_biMultiplyByRadixPower:function(b,c){var a=new rsa.fn._BigInt();rsa.fn._arrayCopy(b.digits,0,a.digits,c,a.digits.length-c);return a},_biDivideByRadixPower:function(b,c){var a=new rsa.fn._BigInt();rsa.fn._arrayCopy(b.digits,c,a.digits,0,a.digits.length-c);return a},_biModuloByRadixPower:function(b,c){var a=new rsa.fn._BigInt();rsa.fn._arrayCopy(b.digits,0,a.digits,0,c);return a},_biCompare:function(a,c){if(a.isNeg!=c.isNeg){return 1-2*Number(a.isNeg)}for(var b=a.digits.length-1;b>=0;--b){if(a.digits[b]!=c.digits[b]){if(a.isNeg){return 1-2*Number(a.digits[b]>c.digits[b])}else{return 1-2*Number(a.digits[b]<c.digits[b])}}}return 0},_biDivideModulo:function(g,f){var a=rsa.fn._biNumBits(g);var e=rsa.fn._biNumBits(f);var d=f.isNeg;var o,m;if(a<e){if(g.isNeg){o=rsa.fn._biCopy(rsa.fn.params.bigOne);o.isNeg=!f.isNeg;g.isNeg=false;f.isNeg=false;m=rsa.fn._biSubtract(f,g);g.isNeg=true;f.isNeg=d}else{o=new rsa.fn._BigInt();m=rsa.fn._biCopy(g)}return new Array(o,m)}o=new rsa.fn._BigInt();m=g;var k=Math.ceil(e/rsa.fn.params.bitsPerDigit)-1;var h=0;while(f.digits[k]<rsa.fn.params.biHalfRadix){f=rsa.fn._biShiftLeft(f,1);++h;++e;k=Math.ceil(e/rsa.fn.params.bitsPerDigit)-1}m=rsa.fn._biShiftLeft(m,h);a+=h;var u=Math.ceil(a/rsa.fn.params.bitsPerDigit)-1;var B=rsa.fn._biMultiplyByRadixPower(f,u-k);while(rsa.fn._biCompare(m,B)!=-1){++o.digits[u-k];m=rsa.fn._biSubtract(m,B)}for(var z=u;z>k;--z){var l=(z>=m.digits.length)?0:m.digits[z];var A=(z-1>=m.digits.length)?0:m.digits[z-1];var w=(z-2>=m.digits.length)?0:m.digits[z-2];var v=(k>=f.digits.length)?0:f.digits[k];var c=(k-1>=f.digits.length)?0:f.digits[k-1];if(l==v){o.digits[z-k-1]=rsa.fn.params.maxDigitVal}else{o.digits[z-k-1]=Math.floor((l*rsa.fn.params.biRadix+A)/v)}var s=o.digits[z-k-1]*((v*rsa.fn.params.biRadix)+c);var p=(l*rsa.fn.params.biRadixSquared)+((A*rsa.fn.params.biRadix)+w);while(s>p){--o.digits[z-k-1];s=o.digits[z-k-1]*((v*rsa.fn.params.biRadix)|c);p=(l*rsa.fn.params.biRadix*rsa.fn.params.biRadix)+((A*rsa.fn.params.biRadix)+w)}B=rsa.fn._biMultiplyByRadixPower(f,z-k-1);m=rsa.fn._biSubtract(m,rsa.fn._biMultiplyDigit(B,o.digits[z-k-1]));if(m.isNeg){m=rsa.fn._biAdd(m,B);--o.digits[z-k-1]}}m=rsa.fn._biShiftRight(m,h);o.isNeg=g.isNeg!=d;if(g.isNeg){if(d){o=rsa.fn._biAdd(o,rsa.fn.params.bigOne)}else{o=rsa.fn._biSubtract(o,rsa.fn.params.bigOne)}f=rsa.fn._biShiftRight(f,h);m=rsa.fn._biSubtract(f,m)
}if(m.digits[0]==0&&rsa.fn._biHighIndex(m)==0){m.isNeg=false}return new Array(o,m)},_biDivide:function(a,b){return rsa.fn._biDivideModulo(a,b)[0]},_biModulo:function(a,b){return rsa.fn._biDivideModulo(a,b)[1]},_biMultiplyMod:function(b,c,a){return rsa.fn._biModulo(rsa.fn._biMultiply(b,c),a)},_biPow:function(c,e){var b=rsa.fn.params.bigOne;var d=c;while(true){if((e&1)!=0){b=rsa.fn._biMultiply(b,d)}e>>=1;if(e==0){break}d=rsa.fn._biMultiply(d,d)}return b},_biPowMod:function(d,g,c){var b=rsa.fn.params.bigOne;var e=d;var f=g;while(true){if((f.digits[0]&1)!=0){b=rsa.fn._biMultiplyMod(b,e,c)}f=rsa.fn._biShiftRight(f,1);if(f.digits[0]==0&&rsa.fn._biHighIndex(f)==0){break}e=rsa.fn._biMultiplyMod(e,e,c)}return b},_pair:function(c,d,b){var a=rsa.fn;this.e=rsa.fn._biFromHex(c);this.d=rsa.fn._biFromHex(d);this.m=rsa.fn._biFromHex(b);this.chunkSize=2*rsa.fn._biHighIndex(this.m);this.radix=16;this.barrett=new rsa.fn._BarrettMu(this.m)},_twoDigit:function(){return(n<10?"0":"")+String(n)},_BarrettMu:function(a){this.modulus=rsa.fn._biCopy(a);this.k=rsa.fn._biHighIndex(this.modulus)+1;var b=new rsa.fn._BigInt();b.digits[2*this.k]=1;this.mu=rsa.fn._biDivide(b,this.modulus);this.bkplus1=new rsa.fn._BigInt();this.bkplus1.digits[this.k+1]=1;this.modulo=rsa.fn._BarrettMu_modulo;this.multiplyMod=rsa.fn._BarrettMu_multiplyMod;this.powMod=rsa.fn._BarrettMu_powMod},_BarrettMu_modulo:function(h){var g=rsa.fn._biDivideByRadixPower(h,this.k-1);var e=rsa.fn._biMultiply(g,this.mu);var d=rsa.fn._biDivideByRadixPower(e,this.k+1);var c=rsa.fn._biModuloByRadixPower(h,this.k+1);var k=rsa.fn._biMultiply(d,this.modulus);var b=rsa.fn._biModuloByRadixPower(k,this.k+1);var a=rsa.fn._biSubtract(c,b);if(a.isNeg){a=rsa.fn._biAdd(a,this.bkplus1)}var f=rsa.fn._biCompare(a,this.modulus)>=0;while(f){a=rsa.fn._biSubtract(a,this.modulus);f=rsa.fn._biCompare(a,this.modulus)>=0}return a},_BarrettMu_multiplyMod:function(a,c){var b=rsa.fn._biMultiply(a,c);return this.modulo(b)},_BarrettMu_powMod:function(c,f){var b=new rsa.fn._BigInt();b.digits[0]=1;var d=c;var e=f;while(true){if((e.digits[0]&1)!=0){b=this.multiplyMod(b,d)}e=rsa.fn._biShiftRight(e,1);if(e.digits[0]==0&&rsa.fn._biHighIndex(e)==0){break}d=this.multiplyMod(d,d)}return b}};